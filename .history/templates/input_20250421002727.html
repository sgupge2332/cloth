<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>今日のコーディネート提案</title>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --primary-color: #4e9f3d;
      --primary-light: #8fd694;
      --primary-dark: #2c7113;
      --accent-color: #f8b400;
      --bg-gradient-1: #d4fc79;
      --bg-gradient-2: #96e6a1;
      --sunny: #f8b400;
      --cloudy: #8c9cb5;
      --rainy: #689ad8;
      --snowy: #c5e3fa;
    }
    
    * {
      box-sizing: border-box;
      transition: all 0.3s ease;
    }
    
    body {
      font-family: 'Noto Sans JP', sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, var(--bg-gradient-1), var(--bg-gradient-2));
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .container {
      background: white;
      border-radius: 24px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      width: 100%;
      max-width: 700px;
      overflow: hidden;
      animation: fadeIn 1s ease forwards;
    }
    
    @keyframes fadeIn {
      from { transform: translateY(40px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    header {
      background: var(--primary-color);
      color: white;
      padding: 25px;
      text-align: center;
      position: relative;
    }
    
    header h1 {
      margin: 0;
      font-size: 1.8em;
      font-weight: 700;
    }
    
    header .subtitle {
      margin-top: 5px;
      font-size: 1em;
      opacity: 0.9;
    }
    
    .header-icon {
      position: absolute;
      top: -15px;
      right: -15px;
      background: var(--accent-color);
      width: 60px;
      height: 60px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 28px;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
    }
    
    form {
      padding: 30px;
    }
    
    .form-group {
      margin-bottom: 22px;
    }
    
    .auto-input-section {
      background: #f9fbf7;
      border-radius: 16px;
      padding: 20px;
      border: 2px dashed var(--primary-light);
      margin-bottom: 30px;
    }
    
    .auto-input-title {
      display: flex;
      align-items: center;
      color: var(--primary-dark);
      font-weight: 700;
      margin-bottom: 15px;
      font-size: 1.1em;
    }
    
    .auto-input-title i {
      margin-right: 8px;
      color: var(--primary-color);
    }
    
    /* 2行2列のグリッドスタイル */
    .info-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 15px;
    }
    
    @media (max-width: 600px) {
      .info-grid {
        grid-template-columns: repeat(2, 1fr);
        grid-template-rows: repeat(2, 1fr);
        gap: 10px;
      }
    }
    
    .auto-input-group {
      position: relative;
      background: white;
      border-radius: 12px;
      padding: 15px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      border: 2px solid var(--primary-light);
      overflow: hidden;
      height: 100%;
      display: flex;
      flex-direction: row;
      align-items: center;
      min-height: 100px;
    }
    
    /* 天気パネルの特別スタイル */
    .weather-panel {
      padding: 10px;
      text-align: center;
      position: relative;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .weather-panel .label-container {
      border-right: none;
      width: 100%;
      padding-right: 0;
      margin-bottom: 10px;
    }
    
    .weather-panel .value-container {
      width: 100%;
      padding-left: 0;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    
    .weather-icon {
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--sunny);
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 10px;
      font-size: 28px;
      color: white;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
    }
    
    .weather-icon.sunny {
      background: var(--sunny);
      color: white;
    }
    
    .weather-icon.cloudy {
      background: var(--cloudy);
      color: white;
    }
    
    .weather-icon.rainy {
      background: var(--rainy);
      color: white;
    }
    
    .weather-icon.snowy {
      background: var(--snowy);
      color: white;
    }
    
    /* 天気アニメーション */
    @keyframes sunny-animation {
      0% { transform: scale(1) rotate(0deg); }
      50% { transform: scale(1.1) rotate(15deg); }
      100% { transform: scale(1) rotate(0deg); }
    }
    
    @keyframes cloudy-animation {
      0% { transform: translateX(0); }
      50% { transform: translateX(5px); }
      100% { transform: translateX(0); }
    }
    
    @keyframes rainy-animation {
      0% { transform: translateY(0); }
      50% { transform: translateY(2px); }
      100% { transform: translateY(0); }
    }
    
    @keyframes snowy-animation {
      0% { transform: rotate(0deg); }
      50% { transform: rotate(10deg); }
      100% { transform: rotate(0deg); }
    }
    
    .weather-icon.sunny i {
      animation: sunny-animation 3s infinite ease-in-out;
    }
    
    .weather-icon.cloudy i {
      animation: cloudy-animation 3s infinite ease-in-out;
    }
    
    .weather-icon.rainy i {
      animation: rainy-animation 1.5s infinite ease-in-out;
    }
    
    .weather-icon.snowy i {
      animation: snowy-animation 3s infinite ease-in-out;
    }
    
    /* 左側のラベル部分 */
    .label-container {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      width: 40%;
      border-right: 1px dashed var(--primary-light);
      padding-right: 10px;
    }
    
    .auto-input-group .icon {
      font-size: 1.5em;
      color: var(--primary-color);
      display: block;
      margin-bottom: 5px;
      text-align: center;
    }
    
    .auto-input-group .label {
      font-size: 0.85em;
      font-weight: 500;
      color: var(--primary-dark);
      text-align: center;
      display: block;
    }
    
    /* 右側の値部分 */
    .value-container {
      display: flex;
      flex-direction: column;
      justify-content: center;
      width: 60%;
      padding-left: 10px;
      text-align: center;
    }
    
    .auto-input-group:before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: var(--primary-color);
    }
    
    .auto-input-group .value {
      font-size: 1.25em;
      font-weight: 700;
      color: var(--primary-dark);
      display: block;
      line-height: 1.2;
    }
    
    .auto-input-group .secondary-value {
      font-size: 1em;
      font-weight: 500;
      color: #555;
      display: block;
      margin-top: 3px;
    }
    
    .auto-input-group .unit {
      font-size: 0.8em;
      color: #666;
      display: inline-block;
      margin-left: 2px;
    }
    
    label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: #444;
      display: flex;
      align-items: center;
    }
    
    .icon {
      margin-right: 8px;
      color: var(--primary-color);
      width: 22px;
      text-align: center;
    }
    
    input, select, textarea {
      width: 100%;
      padding: 14px;
      border-radius: 12px;
      border: 2px solid #e0e0e0;
      font-size: 1em;
      font-family: 'Noto Sans JP', sans-serif;
    }
    
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(78, 159, 61, 0.2);
    }
    
    button {
      background: var(--primary-color);
      color: white;
      font-size: 1.1em;
      font-weight: 700;
      border: none;
      border-radius: 12px;
      padding: 16px 30px;
      cursor: pointer;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-top: 10px;
      box-shadow: 0 4px 12px rgba(78, 159, 61, 0.3);
    }
    
    button:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: 0 6px 15px rgba(78, 159, 61, 0.4);
    }
    
    button i {
      margin-right: 10px;
      font-size: 1.2em;
    }
    
    ::placeholder {
      color: #aaa;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>今日のコーディネート提案</h1>
      <div class="subtitle">あなたにぴったりのファッションを提案します</div>
      <div class="header-icon">
        <i class="fas fa-tshirt"></i>
      </div>
    </header>
    
    <form action="/suggest" method="post">
      <div class="auto-input-section">
        <div class="auto-input-title">
          <i class="fas fa-magic"></i>今日のコンディション
        </div>
        
        <div class="info-grid">
          <div class="auto-input-group">
            <div class="label-container">
              <i class="fas fa-calendar-alt icon"></i>
              <div class="label">日時</div>
            </div>
            <div class="value-container">
              <div class="value" id="date-display">4月20日</div>
              <div class="secondary-value" id="time-display">14:30</div>
            </div>
          </div>
          
          <div class="auto-input-group">
            <div class="label-container">
              <i class="fas fa-map-marker-alt icon"></i>
              <div class="label">現在地</div>
            </div>
            <div class="value-container">
              <div class="value" id="location-display">東京都</div>
            </div>
          </div>
        
          <div class="auto-input-group">
            <div class="label-container">
              <i class="fas fa-thermometer-half icon"></i>
              <div class="label">気温</div>
            </div>
            <div class="value-container">
              <div class="value" id="temperature-display">22<span class="unit">℃</span></div>
            </div>
          </div>
          
          <!-- 天気パネル - イラスト風 -->
          <div class="auto-input-group weather-panel">
            <div class="label-container">
              <div class="label">天気</div>
            </div>
            <div class="value-container">
              <div class="weather-icon sunny" id="weather-icon">
                <i class="fas fa-sun"></i>
              </div>
              <div class="value" id="weather-display">晴れ</div>
            </div>
          </div>
        </div>
        
        <input type="hidden" id="datetime" name="datetime">
        <input type="hidden" id="location" name="location">
        <input type="hidden" id="temperature" name="temperature">
        <input type="hidden" id="weather" name="weather">
      </div>
      
      <div class="form-group">
        <label for="favorite_color"><i class="fas fa-palette icon"></i>好きな色</label>
        <input type="text" id="favorite_color" name="favorite_color" placeholder="例: 青、赤、モノトーン...">
      </div>
      
      <div class="form-group">
        <label for="owned_clothes"><i class="fas fa-shirt icon"></i>持っている服（カンマ区切り）</label>
        <textarea id="owned_clothes" name="owned_clothes" rows="3" placeholder="例: 青いジーンズ, 白いTシャツ, ベージュのジャケット"></textarea>
      </div>
      
      <div class="form-group">
        <label for="mood"><i class="fas fa-smile icon"></i>今日の気分</label>
        <input type="text" id="mood" name="mood" placeholder="例: 爽やか、カジュアル、クール...">
      </div>
      
    <form action="result.html" method="get">
      <button type="submit">
        <i class="fas fa-wand-magic-sparkles"></i>
        コーディネートを提案
      </button>
    </form>
  </div>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      // 日付・時間を設定
      const now = new Date();
      const options = { month: 'long', day: 'numeric' };
      const dateStr = now.toLocaleDateString('ja-JP', options);
      const timeStr = now.toLocaleTimeString('ja-JP', { hour: '2-digit', minute: '2-digit' });
      
      document.getElementById('date-display').textContent = dateStr;
      document.getElementById('time-display').textContent = timeStr;
      
      // hidden inputにも値を設定
      now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
      document.getElementById('datetime').value = now.toISOString().slice(0, 16);

      // 位置情報取得＆API連携
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          position => {
            const lat = position.coords.latitude;
            const lng = position.coords.longitude;

            fetch("/location", {
              method: "POST",
              headers: {
                "Content-Type": "application/json"
              },
              body: JSON.stringify({ lat, lng })
            })
            .then(res => res.json())
            .then(data => {
              if (data.success) {
                // 場所・気温・天気を表示用と隠し入力に設定
                document.getElementById("location-display").textContent = `${data.state} ${data.city}`;
                document.getElementById("location").value = `${data.state} ${data.city}`;
                
                document.getElementById("temperature-display").innerHTML = `${data.temp}<span class="unit">℃</span>`;
                document.getElementById("temperature").value = data.temp;

                // 天気マッチング
                const weatherDesc = data.weather;
                const weatherKeywords = {
                  "晴": "晴れ",
                  "曇": "曇り",
                  "雨": "雨",
                  "雪": "雪"
                };

                let weatherValue = "晴れ"; // デフォルト
                let weatherIconClass = "sunny";
                let weatherIconHTML = '<i class="fas fa-sun"></i>';
                
                for (const key in weatherKeywords) {
                  if (weatherDesc.includes(key)) {
                    weatherValue = weatherKeywords[key];
                    
                    // アイコンの設定
                    if (weatherValue === "晴れ") {
                      weatherIconClass = "sunny";
                      weatherIconHTML = '<i class="fas fa-sun"></i>';
                    } else if (weatherValue === "曇り") {
                      weatherIconClass = "cloudy";
                      weatherIconHTML = '<i class="fas fa-cloud"></i>';
                    } else if (weatherValue === "雨") {
                      weatherIconClass = "rainy";
                      weatherIconHTML = '<i class="fas fa-cloud-rain"></i>';
                    } else if (weatherValue === "雪") {
                      weatherIconClass = "snowy";
                      weatherIconHTML = '<i class="fas fa-snowflake"></i>';
                    }
                    
                    break;
                  }
                }
                
                document.getElementById("weather-display").textContent = weatherValue;
                document.getElementById("weather").value = weatherValue;
                
                // 天気アイコンの更新
                const weatherIcon = document.getElementById("weather-icon");
                weatherIcon.className = `weather-icon ${weatherIconClass}`;
                weatherIcon.innerHTML = weatherIconHTML;
              } else {
                // APIからデータが取得できない場合のデフォルト値
                document.getElementById("location-display").textContent = "東京都";
                document.getElementById("location").value = "東京都";
                
                document.getElementById("temperature-display").innerHTML = "22<span class='unit'>℃</span>";
                document.getElementById("temperature").value = "22";
                
                document.getElementById("weather-display").textContent = "晴れ";
                document.getElementById("weather").value = "晴れ";
              }
            })
            .catch(err => {
              console.error("APIリクエストに失敗しました", err);
              // エラー時のデフォルト値設定
              document.getElementById("location-display").textContent = "東京都";
              document.getElementById("location").value = "東京都";
              
              document.getElementById("temperature-display").innerHTML = "22<span class='unit'>℃</span>";
              document.getElementById("temperature").value = "22";
              
              document.getElementById("weather-display").textContent = "晴れ";
              document.getElementById("weather").value = "晴れ";
            });
          },
          error => {
            console.error("位置情報の取得に失敗しました。", error);
            // エラー時のデフォルト値設定
            document.getElementById("location-display").textContent = "東京都";
            document.getElementById("location").value = "東京都";
            
            document.getElementById("temperature-display").innerHTML = "22<span class='unit'>℃</span>";
            document.getElementById("temperature").value = "22";
            
            document.getElementById("weather-display").textContent = "晴れ";
            document.getElementById("weather").value = "晴れ";
          }
        );
      } else {
        // 位置情報APIが使えない場合のデフォルト値
        document.getElementById("location-display").textContent = "東京都";
        document.getElementById("location").value = "東京都";
        
        document.getElementById("temperature-display").innerHTML = "22<span class='unit'>℃</span>";
        document.getElementById("temperature").value = "22";
        
        document.getElementById("weather-display").textContent = "晴れ";
        document.getElementById("weather").value = "晴れ";
      }
    });
  </script>
</body>
</html>
"""
